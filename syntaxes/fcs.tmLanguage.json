{
    "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
    "fileTypes": [
        "fcs",
        "fcsmth"
    ],
    "scopeName": "source.fcs",
    "name": "Femcad Script",
    "patterns": [
        {
            "begin": "(?<=:=|=|\\()[^>](?= *(?:[a-z]+,? *)+=>)",
            "end": "(?=\\=>)",
            "patterns": [
                {
                    "match": "([a-z]+),?",
                    "captures": {
                        "1": {
                            "name": "variable.parameter.fcs"
                        }
                    }
                }
            ]
        },
        {
            "include": "#numbers"
        },
        {
            "name": "keyword.operator.comparison.fcs",
            "match": "<=|>=|==|<|>|!="
        },
        {
            "name": "keyword.operator.arithmetic.fcs",
            "match": "\\+|\\-|\\*|\\*\\*|/"
        },
        {
            "name": "keyword.operator.assignment.fcs",
            "match": "=|:="
        },
        {
            "name": "keyword.operator.logical.fcs",
            "comment": "keyword operators that evaluate to True or False",
            "match": "\\b(and|or)\\b"
        },
        {
            "include": "#strings"
        },
        {
            "include": "#comment-line"
        },
        {
            "begin": "^(gclass|gblock|distribution|area|material|thickness|planestress|vertex|layer|volume|filletedpoly|cross_section|beam|traction|curvelcs|curve|pointlcs)",
            "beginCaptures": {
                "1": {
                    "name": "storage.type.class.fcs"
                }
            },
            "end": "(?<= |\\t)(?:(?:{)([a-zA-Z_][a-zA-Z_0-9]*)(?:\\})|([1-9][0-9]*))(?= |\\t)",
            "endCaptures": {
                "1": {
                    "name": "entity.name.class.fcs"
                },
                "2": {
                    "name": "entity.name.class.fcs"
                }
            }
        },
        {
            "comment": "modifikátory, které jsou odděleny pouze mezerou!!",
            "name": "storage.modifier.object.fcs",
            "match": "(?<= )(lcs|curvelcs|xyz|color|area|arc vertex|vertex)(?= )"
        },
        {
            "comment": "modifikátory za kterými musí být závorka nebo uvozovka (může být před nimi znaménko + nebo -)",
            "name": "storage.modifier.object.fcs",
            "match": "(?<= )(if|area|geometry|section|material|t|metadata|styles|prism|parameters|filename|spacings|geometries|boundary|sections|opening|repetitions)(?= +[+-]?(?:\\(|\\[|\\{|\"))"
        },
        {
            "comment": "názvy modifikátorů, které mohou být následovány číslem nebo textem (které může znamenat referenci)",
            "name": "storage.modifier.object.fcs",
            "match": "(?<= )(rho|alpha|lambda|c|linear E|ni|radiusmultiplier|vertexes|fillets|eccentricity|xsection|gclass|geometry_class|vertexlcs|matrix|origin|layer|curve)(?= +(?:\\(|\\[|\\{|[0-9]|[A-Za-z]))"
        },
        {
            "comment": "první slovo víceslovných modifikátorů",
            "name": "storage.modifier.object.fcs",
            "match": "(?<= )(transformation|specialization|repetitions|mapping|boundary|filletedpoly|type)(?= +(?:\\(|\\[|\\{|[A-Za-z]))"
        },
        {
            "comment": "další slova víceslovných modifikátorů",
            "name": "storage.modifier.object.fcs",
            "match": "(?<=[A-Za-z]) +(translation|direction|step|ithparameters|Auto|count|distance|items|Frame)"
        },
        {
            "name": "support.function.fcs",
            "match": "^(browse_report|print|model_shell3d|import)\\b"
        },
        {
            "name": "entity.name.function.fcs",
            "match": "^[A-Za-z][A-Za-z0-9_]*(?= *(?::=|=) *[\\(]? *(?:[a-z]+,? *)+=>)"
        },
        {
            "match": "^[A-Za-z][A-Za-z0-9_]*(?= *(?::=|=))",
            "name": "variable.name.fcs"
        },
        {
            "include": "#fcsFunctions"
        },
        {
            "include": "#fcsConstants"
        },
        {}
    ],
    "repository": {
        "fcsFunctionsGlobal": {
            "comment": "funkce, které stojí samostatně",
            "match": "(?x)\\b(Max|Min|Abs|Round|Truncate|Sqrt|Pow|Exp|Log10|Sin|Cos|Tan|Asin|Acos|Atan(2)?|Argb)\\b",
            "name": "support.function.builtin.fcs",
            "patterns": []
        },
        "fcsFunctionsDot": {
            "comment": "standardní metody/vlastnosti objektů (předchází jim tečka)",
            "match": "(?x)\\b(?<=\\.)(ToString|PointToGcs|GcsToLcs|(T|R)(x|y|z)|(IndexOf)?(Max|Min)(By)?|OrderBy(A|De)scending(More)?|Where|Find(OrDefault)?|Take|Skip|Reverse|Aggregate|Zip|(Get)?CumulativeSums|Sum(Items)?|(Is)?Empty|Count|Select|CollectBy|GetSpacings|Any|All|MaskedSpanSums|MergeDoubles|Mul(tiplyElements)?|ToFCS)\\b",
            "name": "support.function.builtin.fcs",
            "patterns": []
        },
        "fcsFunctionsInClass": {
            "comment": "funkce/vlastnost umístěné v 'globálních' prostorech, není kontrolovano jestli funkce existuje",
            "begin": "(?=(Fcs|FCS|Unit|FCM|Fcm|GCS|Math)\\.(?:\\.[A-Za-z_][A-Za-z0-9_]*)*)",
            "beginCaptures": {
                "1": {
                    "name": "support.class.fcs"
                }
            },
            "end": "(?![A-Za-z0-9_\\.])",
            "contentName": "support.function.fcs",
            "patterns": []
        },
        "fcsFunctions": {
            "patterns": [
                {
                    "include": "#fcsFunctionsGlobal"
                },
                {
                    "include": "#fcsFunctionsDot"
                },
                {
                    "include": "#fcsFunctionsInClass"
                }
            ]
        },
        "fcsConstants": {
            "comment": "globální konstanty",
            "match": "(?x)\\b(PI)\\b",
            "name": "constant.language.fcs",
            "patterns": []
        },
        "numbers": {
            "patterns": [
                {
                    "match": "(?:\\b[0-9]+(?:\\.[0-9]*)?|\\.[0-9]+\\b)(?:[eE][-+]?[0-9]+\\b)?",
                    "name": "constant.numeric.fcs"
                }
            ]
        },
        "comment-line": {
            "patterns": [
                {
                    "name": "comment.line.number-sign.fcs",
                    "begin": "#",
                    "end": "\\n"
                }
            ]
        },
        "strings": {
            "name": "string.quoted.double.fcs",
            "begin": "\"",
            "end": "\"",
            "patterns": [
                {
                    "comment": "vnořené znaky s lomítkem: \n \r ...",
                    "name": "constant.character.escape.fcs",
                    "match": "\\\\(?:p|t|r|n)"
                }
            ]
        }
    }
}